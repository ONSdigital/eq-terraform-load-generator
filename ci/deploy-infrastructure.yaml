platform: linux
inputs:
  - name: eq-terraform-load-generator
params:
  GOOGLE_APPLICATION_CREDENTIALS: /root/gcloud-service-key.json
  TF_VAR_gcp_folder_id: ((eq-gcp.folder_id))
  TF_VAR_gcp_billing_account: ((eq-gcp.billing_account))
  PROJECT_ID:
image_resource:
  type: docker-image
  source:
    repository: ((image_registry))/eq-infrastructure-build-image
run:
  path: bash
  args:
    - -exc
    - |
      cat >$GOOGLE_APPLICATION_CREDENTIALS <<EOL
      ((gcp.service_account_json))
      EOL

      cd eq-terraform-load-generator
      ./scripts/deploy_infrastructure.sh
