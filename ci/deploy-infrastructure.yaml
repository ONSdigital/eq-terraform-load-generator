platform: linux
inputs:
  - name: eq-terraform-load-generator
params:
  TERRAFORM_STATE_BUCKET: 'eq-terraform-load-generator-tfstate'
  IMPORT_EXISTING_PROJECT: false'
run:
  path: bash
  args:
    - -exc
    - |
      cat >((google_application_credentials)) <<EOL
      ((gcp.service_account_json))
      EOL

      ls -la ((google_application_credentials))
      gcloud auth activate-service-account --key-file $GOOGLE_APPLICATION_CREDENTIALS

      cd eq-terraform-load-generator

      tfenv use "$(< .terraform-version)"

      ./scripts/deploy_infrastructure.sh
