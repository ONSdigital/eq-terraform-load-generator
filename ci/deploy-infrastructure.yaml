platform: linux
inputs:
  - name: eq-terraform-load-generator
run:
  path: bash
  args:
    - -exc
    - |
      cat >((google_application_credentials)) <<EOL
      $SERVICE_ACCOUNT_JSON
      EOL

      gcloud auth activate-service-account --key-file ((google_application_credentials))

      cd eq-terraform-load-generator

      tfenv use "$(< .terraform-version)"

      TERRAFORM_STATE_BUCKET=((terraform_state_bucket))
      IMPORT_EXISTING_PROJECT=((import_existing_project))
      PROJECT_NAME=((project_name))
      IMPORT_EXISTING_PROJECT=((import_existing_project))

      ./scripts/deploy_infrastructure.sh
